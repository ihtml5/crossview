<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: normalize/index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: normalize/index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { isObject, hasProp } from '../shared/index';
/**
 * @description 格式化按照emonitor协议采集过来的信息,方便业务二次扩展
 * @module normalize
 */

/**
 * 规格化上报之前异常或者数据请求的数据
 *
 * @param {object} data 上报的数据
 * @return {object} res 结果数据
 * @return {string} res.type 上报类型
 * @return {string} res.url 请求链接
 * @return {string|number} res.code 请求状态，默认为空
 * @return {boolean} res.isErr 是否是异常上报
 * @return {object} res.source 上报的原始数据
 */
export const normalize = (data) => {
  const res = {
    type: '',
    url: '',
    code: '',
    isErr: false,
    source: data,
  };
  if (!isObject(data)) {
    return res;
  }
  if (hasProp(data, 'err_type')) {
    // 错误异常数据标准化
    res.type = data.err_type;
    try {
      if (data.err_desc) {
        const desc = JSON.parse(data.err_desc);
        res.url = desc.url || desc.fileName || data.s_url;
      } else {
        res.url = data.s_url;
      }
    } catch (err) {
      res.url = data.s_url;
      console.warn(err);
    }
    res.isErr = true;
  } else if (hasProp(data, 'cgiurl')) {
    // cgi质量数据标准化
    res.type = 'cgi';
    res.url = data.cgiurl;
    res.code = data.httpcode;
  } else if (hasProp(data, 'resurl')) {
    // cdn质量数据标准化
    res.type = 'cdn';
    res.url = data.resurl;
    res.code = data.httpcode;
  } else if (hasProp(data, 'time_domready')) {
    // 页面质量数据标准化
    res.type = 'pagepf';
    res.url = data.s_url;
    res.code = 200;
  } else if (hasProp(data, 'json_entries')) {
    // 慢日志数据标准化
    res.type = 'slowlog';
    res.url = data.s_url;
    res.code = 200;
  } else if (hasProp(data, 'log')) {
    // 流水日志标准化
    res.type = 'flowlog';
    res.url = data.s_url;
    res.code = 200;
  }
  return res;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-clipboard.html">clipboard</a></li><li><a href="module-cookie.html">cookie</a></li><li><a href="module-emitter.html">emitter</a></li><li><a href="module-error.html">error</a></li><li><a href="module-formatter.html">formatter</a></li><li><a href="module-helper.html">helper</a></li><li><a href="module-http.html">http</a></li><li><a href="module-normalize.html">normalize</a></li><li><a href="module-params.html">params</a></li><li><a href="module-reporter.html">reporter</a></li><li><a href="module-shared.html">shared</a></li><li><a href="module-storage.html">storage</a></li><li><a href="module-traversal.html">traversal</a></li><li><a href="module-ua.html">ua</a></li><li><a href="module-url.html">url</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sun Jan 24 2021 16:37:16 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
